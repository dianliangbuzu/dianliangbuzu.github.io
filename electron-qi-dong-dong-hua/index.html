
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Electron 启动动画 | 电量不足的小站</title>
<meta name="description" content="努力是对于更好生活的向往。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://llllchyi.github.io/favicon.ico?v=1617349620766">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://llllchyi.github.io/styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://llllchyi.github.io">
        <img class="avatar" src="https://llllchyi.github.io/images/avatar.png?v=1617349620766" alt="" width="32px" height="32px">
      </a>
      <a href="https://llllchyi.github.io">
        <h1 class="site-title">电量不足的小站</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://llllchyi.github.io/post-images/electron-qi-dong-dong-hua.jpeg')">
            </div>
          
          <h2 class="post-title">Electron 启动动画</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-12-29</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://llllchyi.github.io/electron/">
                    electron
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p>Electron是通过Chromium和Node.js集成来达到这一开发体验的, 我们可以用React / Vue 很轻松的搭建一个桌面应用程序。应用启动时就避免不了短暂的白屏或者需要启动时加载基础数据。</p>
<p>那么怎样解决这一问题呢?<br>
有APP开发经验的同学肯定立马就想到了 启动动画(开屏广告)。</p>
<p>思路<br>
1.隐藏主窗口, 展示loading窗口<br>
2.主窗口加载完毕<br>
3.ipcRenderer 通知主窗口显示, loading窗口关闭</p>
<h2 id="配置主进程mainjs文件">配置主进程main.js文件</h2>
<ol>
<li>主窗口  show 设置false 隐藏该窗口</li>
</ol>
<pre><code>const createWindow = async () =&gt; {
  mainWindow = new BrowserWindow({
    minHeight: 600,
    minWidth: 1024, width: 1280, height: 720, titleBarStyle: 'hidden', frame: false, show: false
  });
    ……
};
</code></pre>
<h2 id="创建loading窗口">创建loading窗口</h2>
<pre><code>// loading
const createLoadingWindow = async () =&gt; {   
  loadingWindow = new BrowserWindow({
    height: 260,
    width: 650,
    show: true,
    transparent: true,  // 透明窗口
    maximizable: false,  //禁止双击放大
    frame: false   // 去掉顶部操作栏
  })

  loadingWindow.loadURL(url.format({
    // loading.html 加载动画
    pathname: path.join(__dirname, './lib/loading/loading.html'),
    protocol: 'file:',
    slashes: true
  }))
    ……
}
</code></pre>
<h2 id="动画展示隐藏">动画展示隐藏</h2>
<pre><code>import { ipcRenderer } from &quot;electron&quot;;
const ipcMain = require('electron').ipcMain;

// 页面加载完毕时调用 通知关闭loading
ipcRenderer.send(&quot;close-loading-window&quot;);


app.on('ready', () =&gt; {
  // 创建加载动画 
  createLoadingWindow();
  // 创建主窗口
  createWindow();
  // 监听页面加载完毕事件
  ipcMain.on('close-loading-window', () =&gt; {
    
    if(loadingWindow) {
      loadingWindow.close();
    }
    mainWindow.show();
  })
});
</code></pre>
<h2 id="效果预览">效果预览</h2>
<p><img src="https://llllchyi.github.io/post-images/1609226938439.gif" alt="" loading="lazy"><br>
大功告成🎉</p>
<h2 id="不足">不足</h2>
<p>transparent: true,  // 透明窗口<br>
在win7下不起作用</p>
<p>解决方案: 禁用硬件加速(未尝试)<br>
<a href="https://github.com/electron/electron/issues/2170#ref-issue-623539865">https://github.com/electron/electron/issues/2170#ref-issue-623539865</a></p>
<pre><code>app.disableHardwareAcceleration();

app.on('ready', () =&gt; {
  setTimeout(() =&gt; {
    createWindow();
    autoUpdater.checkForUpdatesAndNotify();
    createMenu();
  }, 50);
});
</code></pre>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://llllchyi.github.io/cordova-ios-app/">
              <h3 class="post-title">
                下一篇：Cordova - 打包IOS APP
              </h3>
            </a>
          </div>
          
      </div>

      
        

        
          <div id="disqus_thread"></div>
        
      

      <div class="site-footer">
  <div class="slogan">努力是对于更好生活的向往。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by Gridea | <a class="rss" href="https://llllchyi.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: 'dianliangbuzu',
      apikey: 'so66NUOEsL4GvjcEYrAr0zIKAJJdHsaAPBg41HxjGcEVWKRG9BkDaTJJ0EwzVAd4',
    }
    if ('https://disqus.com/api/oauth/2.0/access_token/') {
      options.api = 'https://disqus.com/api/oauth/2.0/access_token/'
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
